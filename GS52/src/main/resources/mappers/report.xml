<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="Report">
	<select id="showReport" parameterType="com.gs52.vo.task.ReportVO"
		resultType="com.gs52.vo.task.ReportVO">
		SELECT * FROM REPORT WHERE REPORT_EMP_INDEX = #{REPORT_EMP_INDEX}
        AND REPORT_TARGET_DATE BETWEEN #{WEEKSTART} AND #{WEEKEND}
	</select>
	
	<insert id="addReport" parameterType="com.gs52.vo.task.ReportVO">
		INSERT INTO REPORT(REPORT_EMP_INDEX, REPORT_CONTENTS, REPORT_TARGET_DATE)
		VALUES(#{REPORT_EMP_INDEX}, #{REPORT_CONTENTS}, #{REPORT_TARGET_DATE})
	</insert>
	
	<delete id="delReport">
		DELETE FROM REPORT WHERE REPORT_INDEX = #{REPORT_INDEX}
	</delete>
	
	<select id="empList">
		SELECT EMP_NAME, DEPT_INDEX, TEAM_INDEX, POSITION_INDEX, RANK_INDEX
		FROM EMP, DEPT, TEAM, RANK, POSITION
		WHERE EMP.EMP_TEAM_INDEX = TEAM.TEAM_INDEX
		    AND EMP.EMP_POSITION_INDEX = POSITION.POSITION_INDEX
		    AND EMP.EMP_RANK_INDEX = RANK.RANK_INDEX
		    AND TEAM.TEAM_DEPT_INDEX = DEPT.DEPT_INDEX
		    AND EMP_INDEX != #{REPORT_EMP_INDEX}
		    AND (DEPT_INDEX, TEAM_INDEX) 
		        in ( SELECT TEAM_DEPT_INDEX, EMP_TEAM_INDEX 
		                FROM EMP, TEAM
		               WHERE EMP.EMP_TEAM_INDEX = TEAM.TEAM_INDEX 
		                    AND EMP_INDEX = #{REPORT_EMP_INDEX})
		ORDER BY EMP_INDEX;
	</select>
</mapper>